<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ZFun Loading</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- BACKGROUND -->
<div class="background">
    <div class="bg bg1"></div>
    <div class="bg bg2"></div>
    <div class="bg bg3"></div>
    <div class="bg bg4"></div>
</div>

<div class="overlay"></div>

<!-- MAIN WINDOW -->
<div class="window">
    <div class="window-header">
        <span class="window-title">Server</span>
        <span class="window-close">✕</span>
    </div>

    <div class="window-content">

        <h1>
            ZFun Loading
            <span class="spinner"></span>
        </h1>

        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>

        <p id="percent">0%</p>
        <p id="status">Connecting…</p>

        <!-- CURRENT DOWNLOAD (ONE LINE) -->
        <div class="file-list-container" id="file-window">
            <div class="file-item">
                <span class="tag-sys">[WAIT]</span>
                <span class="filename">Waiting for server…</span>
            </div>
        </div>

        <!-- AUTHORS -->
        <div id="authors">
            Project profiles:<br>
            Threeple · LD_munder · EL_SOSO · tupikrupik
        </div>

    </div>
</div>

<!-- TIPS -->
<div class="tips-panel">
    <div class="tips-title">TIPS</div>
    <ul class="tips-list">
        <li>Follow Telegram channel</li>
        <li>The server is regularly updated</li>
        <li>Respect other players</li>
        <li>Enjoy the chaos</li>
    </ul>
</div>

<!-- UPDATES -->
<div class="updates-panel">
    <div class="updates-title">UPDATES</div>
    <ul class="updates-list">
        <li>New gestures added</li>
        <li>Weapon animations improved</li>
        <li>Server optimization</li>
        <li>More updates soon</li>
    </ul>
</div>

<!-- SCRIPT -->
<script>
let totalFiles = 0;

const progressBar = document.getElementById("progress");
const percentEl = document.getElementById("percent");
const statusEl = document.getElementById("status");
const fileWindow = document.getElementById("file-window");

/* replace text, not append */
function setCurrentDownload(html) {
    fileWindow.innerHTML = `<div class="file-item">${html}</div>`;
}

/* ===== GMOD HOOKS ===== */

window.SetStatusChanged = function (status) {
    if (!status) return;

    statusEl.innerText = status;

    const addonMatch = status.match(/'([^']+)'/);
    if (addonMatch && status.toUpperCase().includes("LOADING")) {
        setCurrentDownload(
            `<span class="tag-addon">[ADDON]</span>
             <span class="filename">${addonMatch[1]}</span>`
        );
    } else {
        setCurrentDownload(
            `<span class="tag-sys">[STATUS]</span>
             <span class="filename">${status}</span>`
        );
    }
};

window.DownloadingFile = function (fileName) {
    const clean = fileName.includes("/")
        ? fileName.split("/").pop()
        : fileName;

    statusEl.innerText = "Downloading file…";

    setCurrentDownload(
        `<span class="tag-file">[FILE]</span>
         <span class="filename">${clean}</span>`
    );
};

window.SetFilesTotal = function (total) {
    totalFiles = total;
};

window.SetFilesRemaining = function (remaining) {
    if (totalFiles <= 0) return;

    const done = totalFiles - remaining;
    const percent = (done / totalFiles) * 100;

    progressBar.style.width = percent + "%";
    percentEl.innerText = Math.floor(percent) + "%";
};

/* ===== BROWSER DEMO MODE ===== */
if (!window.gmod) {
    let fake = 0;
    SetFilesTotal(100);

    setInterval(() => {
        fake++;

        SetStatusChanged("LOADING 'addon_" + fake + "'");
        DownladingFake("file_" + fake + ".dat");
        SetFilesRemaining(100 - fake);

        if (fake >= 100) fake = 0;
    }, 700);
}

function DownladingFake(name) {
    window.DownloadingFile(name);
}
</script>

</body>
</html>
